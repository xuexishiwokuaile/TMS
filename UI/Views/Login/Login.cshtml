
@{
    ViewBag.Title = "Login";
}

@{
    Layout = null;
}


<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    @Styles.Render("~/Content/css")
    <link href="~/Content/layui/css/login.css" rel="stylesheet" />

</head>


<body class="layui-layout-body layui-bg-black">
    <div class="layui-fluid" style="padding: 0px;">
        <canvas id="particle"></canvas>
        <br />
        <div class="layui-form layui-form-pane layui-admin-login">
            <div class="layui-admin-login-header" style="text-align:center;color:black">
                <h1>登录</h1>
            </div>
            <br />
            <br />
            <br />
            <div class="layui-form-item">
                <label class="layui-form-label layui-bg-black">
                    <i class="layui-icon layui-icon-username"></i>用户名
                </label>
                <div class="layui-input-block ">
                    <input required lay-verify="required" name="userid" class="layui-input" type="text" placeholder="请输入用户名" autocomplete="off" style="color:black" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label layui-bg-black">
                    <i class="layui-icon layui-icon-password"></i>密码
                </label>
                <div class="layui-input-block">
                    <input required lay-verify="required" name="userpassword" class="layui-input" type="password" placeholder="请输入密码" autocomplete="off" style="color:black" />
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <img id="verifycode" style="height: 36px;
                width: 108px;
                margin-left: -15px;
                margin-top: -8px;
    cursor: pointer;" src="@Url.Action("CreateVerifyCode","Login")" />
                </label>
                <div class="layui-input-block">
                    <input required lay-verify="required" name="verifycode" class="layui-input" type="text" placeholder="请输入验证码" autocomplete="off" />
                </div>
            </div>
            <div class="layui-form-item">
                @*<input type="checkbox" pane name="remember" id="remember_user" title="记住密码" lay-skin="primary" />*@
                <a id="forget_pwd" style="margin-top:10px;float:right;color:#009688" href="javascript:;" >忘记密码？</a>
            </div>
            <div class="layui-form-item">
                <div class="layui-btn-container">
                    <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="login">
                        <i class="layui-icon layui-icon-ok-circle"></i>登录
                    </button>
                </div>
            </div>
        </div>
    </div>

    @Scripts.Render("~/bundles/layui")
    <script>


    layui.use(['layer', 'form'], function () {
        var layer = layui.layer,
            form = layui.form,
            $ = layui.jquery;
        //登录响应
        form.on("submit(login)", function (obj) {

            var user = obj.field;
            //layer.load(3)
            $.ajax({
                type: "POST",
                url: "@Url.Action("LoginSubmit")",
                data: user,
                success: function (result) {

                    if (result.Success==1) {
                        window.location.href = "@Url.Action("../Home/Index")";
                    }
                    else
                    {
                        if (result.Success == -1)
                            $("#verifycode").attr("src", "@Url.Action("CreateVerifyCode")?" + Math.random());
                        layer.msg(result.Message, { btn: ['好的'] });

                    }
                }

            })
        })
        //点击发送验证码响应
        @*$("#sendCode").on("click", function () {
            debugger
            var email = $('#verifyReset input[ name=\'email\' ] ').val();
            if (email == ""||email==null) {
                        //发送验证码
                 alert("请输入邮箱号")
            }
            else
            {
                //判断该账号是否存在
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("SendCode","Login")",
                    data: {
                        email: email
                    },
                    success: function (result) {
                        if (result.code == 0) {
                            alert(result.msg)
                        }
                        else {

                            alert(result.msg)
                        }
                    }

                }) 
            }
           
            //发送验证码
            
        })*@
        //忘记密码响应
        $("#forget_pwd").on("click", function () {
            layer.open({
             type: 1,
            skin:'layui-bg-black',
            area: ['400px', '400px'],
            shadeClose: true, //点击遮罩关闭
            btnAlign: 'c',
            title: '密码重置验证',
            content: $('#verifyReset'),
                btn: ['提交'],
                success: function () {
                    //点击发送验证码
                    form.on('submit(sendCode)', function (obj) {
                        var email = $('#verifyReset input[ name=\'email\' ] ').val();
                        if (email == ""||email==null) {
                                    //发送验证码
                             alert("请输入邮箱号")
                        }
                        else
                        {
                            //判断该账号是否存在
                            $.ajax({
                                type: "POST",
                                url: "@Url.Action("SendCode","Login")",
                                data: {
                                    email: email
                                },
                                success: function (result) {
                                    if (result.code == 0) {
                                        alert(result.msg)
                                    }
                                    else {

                                        alert(result.msg)
                                    }
                                }

                            }) 
                        }
                 });
                },
                btn1: function (layero, index) {
                var email = $('#verifyReset input[ name=\'email\' ] ').val();
                var verifyCode = $('#verifyReset input[ name=\'EVerifyCode\' ] ').val();
                var pwd1 = $('#verifyReset input[ name=\'pwd1\' ] ').val();
                var pwd2 = $('#verifyReset input[ name=\'pwd2\' ] ').val();
                if (verifyCode == "" || verifyCode == null) {
                   alert('验证码为空请重新输入')
                }
                else {
                     $.ajax({
                    type: "POST",
                    url: "@Url.Action("VerifyECode","Login")",
                     data: {
                        email:email,
                        code: verifyCode,
                        pwd1: pwd1,
                        pwd2: pwd2
                    },
                    success: function (result) {
                        if (result.success) {
                            alert(result.msg)
                            layer.close(layer.index)
                        }
                        else {
                            alert(result.msg)
                        }
                    }

                }) 
                }
            },
            end: function () {
                $('#verifyReset input[ name=\'EVerifyCode\' ] ').val("");
                $('#verifyReset input[ name=\'email\' ] ').val("");
                $('#verifyReset input[ name=\'pwd1\' ] ').val("");
                $('#verifyReset input[ name=\'pwd2\' ] ').val("");
                form.render()
            }
        });

        })
        //点击验证码图片重置图片
         $("#verifycode").on("click", function () {
             $("#verifycode").attr("src", "@Url.Action("CreateVerifyCode")?" + Math.random());
        })
    })
       
    </script> 


    <div class="layui-footer layui-bg-black" style="position:fixed; bottom:0;height:40px;font-size:16px;margin-left:630px;">
        <!-- 底部固定区域 -->
        @DateTime.Now.Year - 工夹具全寿命智能管理系统
    </div>
</body>
</html>
<div id="verifyReset" class="layui-bg-black"  style="margin-top: 10px; display: none " >
    <form class="layui-form" action="" lay-filter="verfyForm" id="verfyForm">
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:auto">邮箱</label>
            <div class="layui-input-block">
                <input name="email" class="layui-input" lay-verify="required" type="text" placeholder="请输入你要重置的账户绑定的邮箱号" autocomplete="off">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:auto">设置密码</label>
            <div class="layui-input-block">
                <input name="pwd1" class="layui-input" type="password" autocomplete="off">
            </div>
        </div><div class="layui-form-item">
            <label class="layui-form-label" style="width:auto">再次输入</label>
            <div class="layui-input-block">
                <input name="pwd2" class="layui-input"  type="password" autocomplete="off">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label" style="width:auto">验证码</label>
                <div class="layui-input-block ">
                    <div class="layui-inline">
                        <input name="EVerifyCode" class="layui-input" type="text" placeholder="请输入验证码" autocomplete="off">
                    </div>
                    <div class="layui-inline">
                        <button class="layui-btn layui-btn-sm layui-btn-primary" id="sendCode" type="button"
                               lay-submit lay-filter="sendCode">
                            发送验证码
                        </button>
                    </div>
                </div>
            </div>
        </div> 
    </form>
</div>
